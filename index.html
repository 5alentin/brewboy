<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>BrewBoy v1.7</title>
  <link rel="stylesheet" href="styles.css" />
  <link rel="icon" href="favicon.ico" type="image/x-icon" />
  <link rel="icon" href="icon.png" type="image/png" />
  <link rel="apple-touch-icon" href="icon.png" />
  <style>
    /* Language selector button container */
    .lang-selector-container {
      position: fixed;
      top: 10px;
      right: 10px;
      z-index: 1000;
      font-family: monospace;
    }

    .lang-button {
      background: #222;
      color: #eee;
      border: 1px solid #555;
      padding: 6px 12px;
      cursor: pointer;
      user-select: none;
      border-radius: 4px;
      font-size: 14px;
    }

    .lang-dropdown {
      display: none;
      position: absolute;
      right: 0;
      margin-top: 4px;
      background: #222;
      border: 1px solid #555;
      border-radius: 4px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.7);
      min-width: 100px;
    }

    .lang-dropdown.active {
      display: block;
    }

    .lang-dropdown a {
      display: block;
      color: #eee;
      padding: 8px 12px;
      text-decoration: none;
      cursor: pointer;
      font-size: 14px;
    }

    .lang-dropdown a:hover {
      background-color: #444;
    }
  </style>
</head>
<body>
  <div class="hamburger-container">
    <div class="hamburger" id="hamburger-icon">
      <div class="bar"></div>
      <div class="bar"></div>
      <div class="bar"></div>
    </div>
    <nav class="menu" id="menu">
      <ul>
        <li><a href="index.html">BrewBoy</a></li>
        <li><a href="MR_TDS.html">MR.TDS</a></li>
        <!-- Removed language links here -->
      </ul>
    </nav>
  </div>

  <!-- Language selector button on top right -->
  <div class="lang-selector-container">
    <div class="lang-button" id="lang-button">Language ▼</div>
    <div class="lang-dropdown" id="lang-dropdown">
      <a href="#" data-lang="en">English</a>
      <a href="#" data-lang="es">Español</a>
      <a href="#" data-lang="ja">日本語</a>
    </div>
  </div>

  <h1 id="title">BrewBoy v1.7</h1>

  <div class="input-container">
    <div>
      <label for="dose" id="label-dose">Dose (g):</label>
      <input type="number" id="dose" inputmode="decimal" />
    </div>
    <div>
      <label for="ratio" id="label-ratio">Ratio:</label>
      <input type="number" id="ratio" inputmode="decimal" />
    </div>
    <div>
      <label for="water-output" id="label-water">Water:</label>
      <input type="text" id="water-output" readonly />
    </div>
  </div>

  <div class="dropdown-container">
    <div>
      <label for="profile" id="label-profile">Profile:</label>
      <select id="profile">
        <option value="standard">Standard</option>
        <option value="sweeter">Sweeter</option>
        <option value="brighter">Brighter</option>
      </select>
      <p id="profile-description" class="description"></p>
    </div>
    <div>
      <label for="strength" id="label-strength">Strength:</label>
      <select id="strength">
        <option value="lighter">Lighter</option>
        <option value="standard">Standard</option>
        <option value="stronger">Stronger</option>
      </select>
    </div>
  </div>

  <button id="calculate">Calculate</button>

  <h2 class="hidden" id="results-header">Calculated Pulses</h2>
  <table id="result-table" class="hidden" border="1">
    <thead>
      <tr>
        <th id="th-pulse">Pulse</th>
        <th id="th-amount">Amount (g)</th>
        <th id="th-percent">%</th>
        <th id="th-total">Running Total</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <div id="custom-recipe-editor">
    <label for="custom-recipe-input" id="label-custom">Custom Recipe Percentages (comma separated):</label>
    <input type="text" id="custom-recipe-input" />
    <button id="save-custom-recipe">Use Custom Recipe</button>
  </div>

  <script>
    const translations = {
      en: {
        title: "BrewBoy v1.7",
        labelDose: "Dose (g):",
        labelRatio: "Ratio:",
        labelWater: "Water:",
        labelProfile: "Profile:",
        labelStrength: "Strength:",
        labelCustom: "Custom Recipe Percentages (comma separated):",
        buttonCalculate: "Calculate",
        buttonCustom: "Use Custom Recipe",
        resultsHeader: "Calculated Pulses",
        pulse: "Pulse",
        amount: "Amount (g)",
        percent: "%",
        total: "Running Total",
        placeholders: {
          dose: "Enter dose in grams",
          ratio: "Enter ratio (e.g., 15)",
          custom: "e.g., 25,25,25,25"
        }
      },
      es: {
        title: "BrewBoy v1.7",
        labelDose: "Dosis (g):",
        labelRatio: "Relación:",
        labelWater: "Agua:",
        labelProfile: "Perfil:",
        labelStrength: "Fuerza:",
        labelCustom: "Porcentajes de receta personalizada (separados por comas):",
        buttonCalculate: "Calcular",
        buttonCustom: "Usar receta personalizada",
        resultsHeader: "Pulsos calculados",
        pulse: "Pulso",
        amount: "Cantidad (g)",
        percent: "%",
        total: "Total acumulado",
        placeholders: {
          dose: "Ingrese dosis en gramos",
          ratio: "Ingrese relación (ej. 15)",
          custom: "ej. 25,25,25,25"
        }
      },
      ja: {
        title: "BrewBoy v1.7",
        labelDose: "分量 (g):",
        labelRatio: "比率:",
        labelWater: "水量:",
        labelProfile: "プロファイル:",
        labelStrength: "強さ:",
        labelCustom: "カスタムレシピの割合 (カンマ区切り):",
        buttonCalculate: "計算する",
        buttonCustom: "カスタムレシピを使う",
        resultsHeader: "計算されたパルス",
        pulse: "パルス",
        amount: "量 (g)",
        percent: "%",
        total: "累積合計",
        placeholders: {
          dose: "分量をグラムで入力",
          ratio: "比率を入力 (例: 15)",
          custom: "例: 25,25,25,25"
        }
      }
    };

    function applyTranslations(lang) {
      const t = translations[lang];
      if (!t) return;
      document.getElementById("title").textContent = t.title;
      document.getElementById("label-dose").textContent = t.labelDose;
      document.getElementById("label-ratio").textContent = t.labelRatio;
      document.getElementById("label-water").textContent = t.labelWater;
      document.getElementById("label-profile").textContent = t.labelProfile;
      document.getElementById("label-strength").textContent = t.labelStrength;
      document.getElementById("label-custom").textContent = t.labelCustom;
      document.getElementById("calculate").textContent = t.buttonCalculate;
      document.getElementById("save-custom-recipe").textContent = t.buttonCustom;
      document.getElementById("results-header").textContent = t.resultsHeader;
      document.getElementById("th-pulse").textContent = t.pulse;
      document.getElementById("th-amount").textContent = t.amount;
      document.getElementById("th-percent").textContent = t.percent;
      document.getElementById("th-total").textContent = t.total;
      document.getElementById("dose").placeholder = t.placeholders.dose;
      document.getElementById("ratio").placeholder = t.placeholders.ratio;
      document.getElementById("custom-recipe-input").placeholder = t.placeholders.custom;

      // Update lang button text to show selected language in native name
      const langNames = { en: "en", es: "🇵🇷", ja: "🇯🇵" };
      document.getElementById("lang-button").textContent = langNames[lang] + " 🌐";
    }

    document.getElementById("hamburger-icon").addEventListener("click", () => {
      document.getElementById("menu").classList.toggle("active");
    });

    // Language dropdown toggle
    const langButton = document.getElementById("lang-button");
    const langDropdown = document.getElementById("lang-dropdown");

    langButton.addEventListener("click", () => {
      langDropdown.classList.toggle("active");
    });

    // Close dropdown when clicking outside
    document.addEventListener("click", (e) => {
      if (!langButton.contains(e.target) && !langDropdown.contains(e.target)) {
        langDropdown.classList.remove("active");
      }
    });

    // Language selection
    document.querySelectorAll('#lang-dropdown a').forEach(link => {
      link.addEventListener('click', e => {
        e.preventDefault();
        const lang = e.target.getAttribute('data-lang');
        applyTranslations(lang);
        langDropdown.classList.remove("active");
        document.getElementById("menu").classList.remove("active");
      });
    });

    // Initialize with English
    applyTranslations("en");

    // Rest of your existing JS (water output update, calculation etc.) remains unchanged
    function updateWaterOutput() {
      const dose = parseFloat(document.getElementById("dose").value);
      const ratio = parseFloat(document.getElementById("ratio").value);
      const waterOutput = document.getElementById("water-output");
      if (!isNaN(dose) && !isNaN(ratio) && dose > 0 && ratio > 0) {
        const totalWater = Math.round(dose * ratio);
        waterOutput.value = totalWater + "g";
      } else {
        waterOutput.value = "";
      }
    }

    document.getElementById("dose").addEventListener("input", updateWaterOutput);
    document.getElementById("ratio").addEventListener("input", updateWaterOutput);

    const profileDescriptions = {
      standard: "",
      sweeter: "",
      brighter: "",
      custom: "",
    };

    function updateProfileDescription() {
      const profile = document.getElementById("profile").value;
      document.getElementById("profile-description").textContent =
        profileDescriptions[profile] || "";
    }

    document.getElementById("profile").addEventListener("change", updateProfileDescription);

    let customRecipe = [];

    document.getElementById("save-custom-recipe").addEventListener("click", () => {
      const input = document.getElementById("custom-recipe-input").value;
      try {
        customRecipe = input
          .split(",")
          .map(p => parseFloat(p.trim()))
          .filter(n => !isNaN(n));
        const sum = customRecipe.reduce((a, b) => a + b, 0);
        if (Math.abs(sum - 100) > 0.01) {
          alert("Custom recipe percentages must sum to 100.");
          customRecipe = [];
          return;
        }
        if (!document.querySelector('#profile option[value="custom"]')) {
          const option = document.createElement("option");
          option.value = "custom";
          option.text = "Custom";
          document.getElementById("profile").appendChild(option);
        }
        document.getElementById("profile").value = "custom";
        document.getElementById("strength").disabled = true;
        updateProfileDescription();
        document.getElementById("calculate").click();
      } catch {
        alert("Invalid input for custom recipe.");
        customRecipe = [];
      }
    });

    document.getElementById("profile").addEventListener("change", function () {
      if (this.value !== "custom") {
        document.getElementById("strength").disabled = false;
        updateProfileDescription();
      }
    });

    document.getElementById("calculate").addEventListener("click", function () {
      const dose = parseFloat(document.getElementById("dose").value);
      const ratio = parseFloat(document.getElementById("ratio").value);
      const profile = document.getElementById("profile").value;
      const strength = document.getElementById("strength").value;
      const tableBody = document.getElementById("result-table").getElementsByTagName("tbody")[0];
      const resultsHeader = document.getElementById("results-header");

      tableBody.innerHTML = "";

      if (isNaN(dose) || isNaN(ratio) || dose <= 0 || ratio <= 0) {
        alert("Please enter valid positive numbers for dose and ratio.");
        return;
      }

      resultsHeader.classList.remove("hidden");
      document.getElementById("result-table").classList.remove("hidden");

      const totalWater = Math.round(dose * ratio);

      const profileData = {
        standard: [20, 20],
        sweeter: [16.67, 23.33],
        brighter: [23.33, 16.67],
      };

      const strengthData = {
        lighter: [60],
        standard: [30, 30],
        stronger: [20, 20, 20],
      };

      let percentages = [];

      if (profile === "custom") {
        percentages = customRecipe;
      } else {
        // Combine profile and strength data, simplified example:
        percentages = profileData[profile] || profileData.standard;
      }

      // Just an example distribution for demo purposes, replace with real logic
      let cumulative = 0;
      percentages.forEach((pct, i) => {
        const amount = Math.round((pct / 100) * totalWater);
        cumulative += amount;
        const row = document.createElement("tr");
        row.innerHTML = `
          <td>${i + 1}</td>
          <td>${amount}g</td>
          <td>${pct}%</td>
          <td>${cumulative}g</td>
        `;
        tableBody.appendChild(row);
      });
    });
  </script>
</body>
</html>
